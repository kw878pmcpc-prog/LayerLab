<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LayerLab â€” Smarter fragrance layering, made simple.</title>
<style>
:root { --bg:#0b0e14; --fg:#e6e6e6; --muted:#aaa; --card:#141925; --accent:#8ac8ff; --border:#263042; }
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,sans-serif}
.app-header{text-align:center;padding:2rem 1rem;border-bottom:1px solid var(--border)}
.tagline{color:var(--muted)}
.container{max-width:980px;margin:2rem auto;padding:0 1rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1rem;margin-bottom:1rem}
label{display:block;margin:.5rem 0;font-size:.95rem}
input,textarea{width:100%;padding:.6rem .75rem;border-radius:10px;border:1px solid var(--border);background:#0f1420;color:var(--fg)}
button{margin-top:.8rem;padding:.6rem 1.1rem;border:none;border-radius:10px;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
.row{display:flex;gap:.6rem;flex-wrap:wrap}
.row > *{flex:1}
#library,#results{margin-top:1rem}
.fragrance{border:1px solid var(--border);border-radius:10px;padding:.6rem .75rem;margin:.4rem 0;background:#0f1420}
.result{border:1px solid var(--border);border-radius:10px;padding:.8rem;margin-top:.6rem;background:#0f1420}
small.muted{color:var(--muted)}
.app-footer{text-align:center;padding:1rem;color:var(--muted);border-top:1px solid var(--border)}
a.link{color:var(--accent);text-decoration:none}
input[type=file]{background:#0f1420;padding:.6rem;border-radius:10px;border:1px solid var(--border);color:var(--fg)}
</style>
</head>
<body>
  <header class="app-header">
    <h1>LayerLab</h1>
    <p class="tagline">Smarter fragrance layering, made simple.</p>
  </header>

  <main class="container">
    <!-- Add -->
    <section class="card">
      <h2>Add a Fragrance</h2>
      <div class="row">
        <label>Name <input id="fName" placeholder="e.g., Amber Horizon" /></label>
        <label>Brand <input id="fBrand" placeholder="e.g., PerfumeHouse" /></label>
      </div>
      <div class="row">
        <label>Top Notes <input id="fTop" placeholder="comma-separated (e.g., bergamot, green tea)" /></label>
        <label>Heart Notes <input id="fHeart" placeholder="e.g., rose, cardamom" /></label>
        <label>Base Notes <input id="fBase" placeholder="e.g., cedar, amber, musk" /></label>
      </div>
      <button id="addBtn">Add to Library</button>
      <small class="muted">Tip: raw notes will be auto-mapped to families when recommending.</small>
    </section>

    <!-- Import / Export -->
    <section class="card">
      <h2>Import / Export</h2>
      <div class="row">
        <div>
          <label>Import CSV
            <input id="csvInput" type="file" accept=".csv" />
          </label>
          <small class="muted">
            Expected headers: <code>name,brand,top,heart,base</code> (strings; notes comma-separated).
          </small>
        </div>
        <div>
          <button id="exportBtn">Export Library as CSV</button><br/>
          <small class="muted">Downloads your current library.</small>
        </div>
      </div>
      <details style="margin-top:.5rem">
        <summary>CSV example (copy into a file)</summary>
        <pre style="white-space:pre-wrap">
name,brand,top,heart,base
Amber Horizon,Aether Co,vanilla,amber,"woody; resinous"
Citrus Veil,Solaire,"bergamot, green tea","orange blossom",musk
Velvet Smoke,NoirWorks,black pepper,smoke,"amber; cedar"
Ocean Muse,BlueNote,"sea notes; green","herbal; aromatic",musk
Rose Ember,Lumine,rose,cardamom,"amber; tonka bean"
        </pre>
      </details>
    </section>

    <!-- Library -->
    <section class="card">
      <h2>Your Library</h2>
      <div id="library"></div>
    </section>

    <!-- Recs -->
    <section class="card">
      <h2>Recommendations</h2>
      <button id="randomBtn">ðŸŽ² Generate Random Combo</button>
      <div id="results"></div>
    </section>

    <!-- Legal -->
    <section class="card">
      <h2>Data & Legal</h2>
      <p class="muted">
        LayerLab does not scrape third-party sites. Import only data you have rights to use.
        If a dataset on GitHub was scraped from a site with terms that forbid scraping, using it may be unlawful.
      </p>
    </section>
  </main>

  <footer class="app-footer">
    <small>Â© 2025 LayerLab â€” Created by PerfumePeter</small>
  </footer>

<script>
// ====== Sample data ======
const sampleFragrances = [
  { name:"Amber Horizon", brand:"Aether Co", notes:{ top:["vanilla"], heart:["amber"], base:["woody","resinous"] } },
  { name:"Citrus Veil", brand:"Solaire", notes:{ top:["bergamot","green tea"], heart:["orange blossom"], base:["musk"] } },
  { name:"Velvet Smoke", brand:"NoirWorks", notes:{ top:["black pepper"], heart:["smoke"], base:["amber","cedar"] } },
  { name:"Ocean Muse", brand:"BlueNote", notes:{ top:["sea notes","green"], heart:["herbal","aromatic"], base:["musk"] } },
  { name:"Rose Ember", brand:"Lumine", notes:{ top:["rose"], heart:["cardamom"], base:["amber","tonka bean"] } },
];

// ====== Note â†’ family mapper (expand as needed) ======
const MAP = {
  // citrus
  "bergamot":"citrus","lemon":"citrus","lime":"citrus","grapefruit":"citrus","orange":"citrus","mandarin":"citrus","petitgrain":"citrus",
  // green/fresh
  "green tea":"green","violet leaf":"green","galbanum":"green","basil":"herbal","mint":"herbal","rosemary":"aromatic","sage":"herbal",
  // florals
  "rose":"floral","jasmine":"white floral","tuberose":"white floral","orange blossom":"white floral","ylang-ylang":"floral","lily":"floral",
  // spicy
  "cardamom":"spicy","black pepper":"spicy","pink pepper":"spicy","cinnamon":"spicy","clove":"spicy","nutmeg":"spicy",
  // woods/resins/smoke
  "cedar":"woody","sandalwood":"woody","vetiver":"woody","oud":"woody","incense":"smoky","smoke":"smoky","myrrh":"resinous","labdanum":"resinous","frankincense":"resinous",
  // amber/musk/sweet/gourmand
  "amber":"amber","ambroxan":"amber","musk":"musky","tonka bean":"sweet","vanilla":"sweet","caramel":"gourmand","chocolate":"gourmand",
  // aquatic/aldehydic
  "sea notes":"aquatic","marine":"aquatic","aldehydes":"aldehydic"
};
function toFamilies(noteList){
  return noteList.map(n=>n.toLowerCase().trim())
                 .filter(Boolean)
                 .map(n => MAP[n] || n); // fall back to raw note if unknown
}

// ====== State ======
let library = JSON.parse(localStorage.getItem("layerlab_lib") || "[]");
if (!library.length) library = sampleFragrances.slice();
function save(){ localStorage.setItem("layerlab_lib", JSON.stringify(library)); }

// ====== UI ======
function escapeHtml(s=""){ return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m])); }
function renderLibrary(){
  const div = document.getElementById("library");
  div.innerHTML = "";
  library.forEach(f=>{
    const el = document.createElement("div");
    el.className = "fragrance";
    el.innerHTML = `
      <strong>${escapeHtml(f.name)}</strong> <span style="opacity:.8">(${escapeHtml(f.brand)})</span><br/>
      <small>Top:</small> ${(f.notes.top||[]).join(", ") || "â€”"}<br/>
      <small>Heart:</small> ${(f.notes.heart||[]).join(", ") || "â€”"}<br/>
      <small>Base:</small> ${(f.notes.base||[]).join(", ") || "â€”"}
    `;
    div.appendChild(el);
  });
}

// ====== Add manually ======
document.getElementById("addBtn").onclick = ()=>{
  const f = {
    name: document.getElementById("fName").value.trim() || "Untitled",
    brand: document.getElementById("fBrand").value.trim(),
    notes:{
      top:  document.getElementById("fTop").value.split(/[,;]+/).map(s=>s.trim()).filter(Boolean),
      heart:document.getElementById("fHeart").value.split(/[,;]+/).map(s=>s.trim()).filter(Boolean),
      base: document.getElementById("fBase").value.split(/[,;]+/).map(s=>s.trim()).filter(Boolean)
    }
  };
  library.push(f); save(); renderLibrary();
  ["fName","fBrand","fTop","fHeart","fBase"].forEach(id=>document.getElementById(id).value="");
};

// ====== CSV import (safe, user-provided) ======
document.getElementById("csvInput").addEventListener("change", async (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const text = await file.text();
  const rows = text.split(/\r?\n/).filter(r=>r.trim().length);
  if (!rows.length) return alert("CSV is empty");
  const headers = rows[0].split(",").map(h=>h.trim().toLowerCase());
  const idx = (k)=>headers.indexOf(k);
  const req = ["name","brand","top","heart","base"];
  if (req.some(k=>idx(k)===-1)) return alert("Missing headers. Need: name, brand, top, heart, base");
  for (let i=1;i<rows.length;i++){
    const cols = splitCsvLine(rows[i], headers.length);
    if (!cols) continue;
    const name = (cols[idx("name")]||"").trim();
    if (!name) continue;
    const brand = (cols[idx("brand")]||"").trim();
    const top  = splitNotes(cols[idx("top")]);
    const heart= splitNotes(cols[idx("heart")]);
    const base = splitNotes(cols[idx("base")]);
    library.push({ name, brand, notes:{ top, heart, base }});
  }
  save(); renderLibrary();
  alert("Imported!");
});
function splitCsvLine(line, expected){
  // basic CSV splitter supporting quotes
  const out=[], re=/\s*(?:"([^"]*)"|([^,]*))\s*(?:,|$)/g; let m;
  while((m=re.exec(line))!==null){ out.push(m[1] ?? m[2]); }
  if (expected && out.length<expected) {
    // pad
    while(out.length<expected) out.push("");
  }
  return out;
}
function splitNotes(s){ return (s||"").split(/[,;]+/).map(x=>x.trim()).filter(Boolean); }

// ====== Random pairing (with mapping in explanation) ======
function sharedNotes(a,b){
  const allA = [...a.top,...a.heart,...a.base].map(x=>x.toLowerCase());
  const allB = [...b.top,...b.heart,...b.base].map(x=>x.toLowerCase());
  const famA = toFamilies(allA), famB = toFamilies(allB);
  const shared = new Set(famA.filter(x=>famB.includes(x)));
  return Array.from(shared);
}
document.getElementById("randomBtn").onclick = ()=>{
  if (library.length < 2) return alert("Add at least 2 fragrances");
  const i = Math.floor(Math.random()*library.length);
  let j=i; while(j===i) j = Math.floor(Math.random()*library.length);
  const A=library[i], B=library[j];
  const shared = sharedNotes(A.notes, B.notes);
  const resultDiv = document.getElementById("results");
  resultDiv.innerHTML = `
    <div class="result">
      <strong>${escapeHtml(A.name)}</strong> + <strong>${escapeHtml(B.name)}</strong><br/>
      ${shared.length ? `Shared families (auto-mapped): ${shared.join(", ")}` : "Contrasting but complementary!"}
    </div>`;
};

// ====== Export CSV ======
document.getElementById("exportBtn").onclick = ()=>{
  const rows = [["name","brand","top","heart","base"]];
  library.forEach(f=>{
    rows.push([
      f.name,
      f.brand,
      (f.notes.top||[]).join("; "),
      (f.notes.heart||[]).join("; "),
      (f.notes.base||[]).join("; ")
    ]);
  });
  const csv = rows.map(r=>r.map(cell=>/[,"]/.test(cell)?('"'+cell.replace(/"/g,'""')+'"'):cell).join(",")).join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "layerlab_library.csv"; a.click();
  URL.revokeObjectURL(url);
};

// Paint
renderLibrary();
</script>
</body>
</html>
